---
title: mysql学习十二子查询一(WHERE中的子查询)
date: 2017-02-16 13:20:34
categories: mysql
tags: mysql
---

### mysql学习十二子查询一(WHERE中的子查询)
子查询就是指的在一个完整的查询语句之中，嵌套若干个不同功能的小查询，从而一起完成复杂查询的一种编写形式，为了让读者更加清楚子查询的概念。

子查询返回结果
子查询可以返回的数据类型一共分为四种：

单行单列：返回的是一个具体列的内容，可以理解为一个单值数据；
单行多列：返回一行数据中多个列的内容；
多行单列：返回多行记录之中同一列的内容，相当于给出了一个操作范围；
多行多列：查询返回的结果是一张临时表；
在WHERE子句中使用子查询
在WHERE子句之中处理单行单列子查询、多行单列子查询、单行多列子查询。

### 单行单列子查询

#### 查询公司之中工资最低的雇员的完整信息
首先查询出最低工资
```
mysql> SELECT MIN(sal) FROM emp;
+----------+
| MIN(sal) |
+----------+
|   800.00 |
+----------+
1 row in set (0.00 sec)
```
再查询员工信息
```
mysql> SELECT *
    -> FROM emp
    -> WHERE sal =(
    -> SELECT MIN(sal)
    -> FROM emp
    -> );
+-------+-------+-------+------+---------------------+--------+------+--------+
| empno | ename | job   | mgr  | hiredate            | sal    | comm | deptno |
+-------+-------+-------+------+---------------------+--------+------+--------+
|  7369 | SMITH | CLERK | 7902 | 1980-12-17 00:00:00 | 800.00 | NULL |     20 |
+-------+-------+-------+------+---------------------+--------+------+--------+
1 row in set (0.00 sec)
```

#### 查询出基本工资比ALLEN低的全部雇员信息
查出ALLEN的基本工资
```
mysql> SELECT sal
    -> FROM emp
    -> WHERE ename='allen';
+---------+
| sal     |
+---------+
| 1600.00 |
+---------+
1 row in set (0.00 sec)
```

再查出比这个工资还低的员工信息
```
mysql> SELECT *
    -> FROM emp
    -> WHERE sal<(
    -> SELECT sal
    -> FROM emp
    -> WHERE ename='allen'
    -> );
+-------+--------+----------+------+---------------------+---------+---------+--------+
| empno | ename  | job      | mgr  | hiredate            | sal     | comm    | deptno |
+-------+--------+----------+------+---------------------+---------+---------+--------+
|  7369 | SMITH  | CLERK    | 7902 | 1980-12-17 00:00:00 |  800.00 |    NULL |     20 |
|  7521 | WARD   | SALESMAN | 7698 | 1981-02-22 00:00:00 | 1250.00 |  500.00 |     30 |
|  7654 | MARTIN | SALESMAN | 7698 | 1981-09-28 00:00:00 | 1250.00 | 1400.00 |     30 |
|  7844 | TURNER | SALESMAN | 7698 | 1981-09-08 00:00:00 | 1500.00 |    0.00 |     30 |
|  7876 | ADAMS  | CLERK    | 7788 | 1983-01-12 00:00:00 | 1100.00 |    NULL |     20 |
|  7900 | JAMES  | CLERK    | 7698 | 1981-12-03 00:00:00 |  950.00 |    NULL |     30 |
|  7934 | MILLER | CLERK    | 7782 | 1982-01-23 00:00:00 | 1300.00 |    NULL |     10 |
+-------+--------+----------+------+---------------------+---------+---------+--------+
7 rows in set (0.00 sec)
```
#### 查询基本工资高于公司平均薪金的全部雇员信息
平均工资
```
mysql> SELECT AVG(sal)
    -> FROM emp;
+-------------+
| AVG(sal)    |
+-------------+
| 2073.214286 |
+-------------+
1 row in set (0.00 sec)
```
高于平均工资的员工信息
```
mysql> SELECT *
    -> FROM emp
    -> WHERE sal >(
    -> SELECT AVG(sal)
    -> FROM emp
    -> );
+-------+-------+-----------+------+---------------------+---------+------+--------+
| empno | ename | job       | mgr  | hiredate            | sal     | comm | deptno |
+-------+-------+-----------+------+---------------------+---------+------+--------+
|  7566 | JONES | MANAGER   | 7839 | 1981-04-02 00:00:00 | 2975.00 | NULL |     20 |
|  7698 | BLAKE | MANAGER   | 7839 | 1981-05-01 00:00:00 | 2850.00 | NULL |     30 |
|  7782 | CLARK | MANAGER   | 7839 | 1981-06-09 00:00:00 | 2450.00 | NULL |     10 |
|  7788 | SCOTT | ANALYST   | 7566 | 1982-12-09 00:00:00 | 3000.00 | NULL |     20 |
|  7839 | KING  | PRESIDENT | NULL | 1981-11-17 00:00:00 | 5000.00 | NULL |     10 |
|  7902 | FORD  | ANALYST   | 7566 | 1981-12-03 00:00:00 | 3000.00 | NULL |     20 |
+-------+-------+-----------+------+---------------------+---------+------+--------+
6 rows in set (0.00 sec)
```

### 单行多列子查询

#### 查找出与ALLEN从事同一工作，并且基本工资高于雇员编号为7521的全部雇员信息,

先查出ALLEN的工作和编辑为7521的工资,再分别添加条件
```
SELECT * 
FROM emp
WHERE job=(
SELECT job
FROM emp
WHERE ename='allen'
) 
AND sal >(
SELECT sal 
FROM emp
WHERE empno=7521
) AND  NOT ename='allen';
```
#### 查询与SCOTT从事同一工作且工资相同的雇员信息

查询出SCOTT的工作 
```
mysql> SELECT job
    -> FROM emp
    -> WHERE ename='scott';
+---------+
| job     |
+---------+
| ANALYST |
+---------+
1 row in set (0.00 sec)
```
再查询出相同工作的员工
```
mysql> SELECT *
    -> FROM emp
    -> WHERE job=(
    -> SELECT job
    -> FROM emp
    -> WHERE ename='scott'
    -> ) AND NOT ename='scott';
+-------+-------+---------+------+---------------------+---------+------+--------+
| empno | ename | job     | mgr  | hiredate            | sal     | comm | deptno |
+-------+-------+---------+------+---------------------+---------+------+--------+
|  7902 | FORD  | ANALYST | 7566 | 1981-12-03 00:00:00 | 3000.00 | NULL |     20 |
+-------+-------+---------+------+---------------------+---------+------+--------+
1 row in set (0.00 sec)
```
#### 查询与雇员7566从事同一工作且领导相同的全部雇员信息

查询出7566的工作与领导
```
mysql> select job,mgr
    -> from emp
    -> where empno=7566;
+---------+------+
| job     | mgr  |
+---------+------+
| MANAGER | 7839 |
+---------+------+
1 row in set (0.00 sec)
```
再查询出相同的员工
```
mysql> SELECT
    ->   *
    -> FROM
    ->   emp
    -> WHERE (job, mgr) =
    ->   (SELECT
    ->     job,
    ->     mgr
    ->   FROM
    ->     emp
    ->   WHERE empno = 7566) ;
+-------+-------+---------+------+---------------------+---------+------+--------+
| empno | ename | job     | mgr  | hiredate            | sal     | comm | deptno |
+-------+-------+---------+------+---------------------+---------+------+--------+
|  7566 | JONES | MANAGER | 7839 | 1981-04-02 00:00:00 | 2975.00 | NULL |     20 |
|  7698 | BLAKE | MANAGER | 7839 | 1981-05-01 00:00:00 | 2850.00 | NULL |     30 |
|  7782 | CLARK | MANAGER | 7839 | 1981-06-09 00:00:00 | 2450.00 | NULL |     10 |
+-------+-------+---------+------+---------------------+---------+------+--------+
3 rows in set (0.00 sec)
```


### 多行单列子查询
主要使用三种操作符：IN、ANY、ALL
### IN操作

#### 查询出与每个部门中最低工资相同的全部雇员信息
```
mysql> SELECT *
    -> FROM emp
    -> WHERE sal IN(
    -> SELECT MIN(sal)
    -> FROM emp
    -> GROUP BY deptno
    -> );
+-------+--------+-------+------+---------------------+---------+------+--------+
| empno | ename  | job   | mgr  | hiredate            | sal     | comm | deptno |
+-------+--------+-------+------+---------------------+---------+------+--------+
|  7369 | SMITH  | CLERK | 7902 | 1980-12-17 00:00:00 |  800.00 | NULL |     20 |
|  7900 | JAMES  | CLERK | 7698 | 1981-12-03 00:00:00 |  950.00 | NULL |     30 |
|  7934 | MILLER | CLERK | 7782 | 1982-01-23 00:00:00 | 1300.00 | NULL |     10 |
+-------+--------+-------+------+---------------------+---------+------+--------+
3 rows in set (0.00 sec)


```

#### 查询出不与每个部门中最低工资相同的全部雇员信息

```
mysql> SELECT *
    -> FROM emp
    -> WHERE sal NOT IN(
    -> SELECT MIN(sal)
    -> FROM emp
    -> GROUP BY deptno
    -> );
+-------+--------+-----------+------+---------------------+---------+---------+--------+
| empno | ename  | job       | mgr  | hiredate            | sal     | comm    | deptno |
+-------+--------+-----------+------+---------------------+---------+---------+--------+
|  7499 | ALLEN  | SALESMAN  | 7698 | 1981-02-20 00:00:00 | 1600.00 |  300.00 |     30 |
|  7521 | WARD   | SALESMAN  | 7698 | 1981-02-22 00:00:00 | 1250.00 |  500.00 |     30 |
|  7566 | JONES  | MANAGER   | 7839 | 1981-04-02 00:00:00 | 2975.00 |    NULL |     20 |
|  7654 | MARTIN | SALESMAN  | 7698 | 1981-09-28 00:00:00 | 1250.00 | 1400.00 |     30 |
|  7698 | BLAKE  | MANAGER   | 7839 | 1981-05-01 00:00:00 | 2850.00 |    NULL |     30 |
|  7782 | CLARK  | MANAGER   | 7839 | 1981-06-09 00:00:00 | 2450.00 |    NULL |     10 |
|  7788 | SCOTT  | ANALYST   | 7566 | 1982-12-09 00:00:00 | 3000.00 |    NULL |     20 |
|  7839 | KING   | PRESIDENT | NULL | 1981-11-17 00:00:00 | 5000.00 |    NULL |     10 |
|  7844 | TURNER | SALESMAN  | 7698 | 1981-09-08 00:00:00 | 1500.00 |    0.00 |     30 |
|  7876 | ADAMS  | CLERK     | 7788 | 1983-01-12 00:00:00 | 1100.00 |    NULL |     20 |
|  7902 | FORD   | ANALYST   | 7566 | 1981-12-03 00:00:00 | 3000.00 |    NULL |     20 |
+-------+--------+-----------+------+---------------------+---------+---------+--------+
11 rows in set (0.00 sec)

```

### ANY在使用中有如下三种使用形式：
=ANY：表示与子查询中的每个元素进行比较，功能与IN类似（然而<>ANY不等价于NOT IN）
>ANY：比子查询中返回结果的最小的要大（还包含了>=ANY）
<ANY：比子查询中返回结果的最大的要小（还包含了<=ANY）


#### 查询出每个部门经理的工资
```
mysql> SELECT MIN(sal)
    -> FROM emp
    -> WHERE job='manager'
    -> GROUP BY deptno;
+----------+
| MIN(sal) |
+----------+
|  2450.00 |
|  2975.00 |
|  2850.00 |
+----------+
3 rows in set (0.00 sec)
```

```
mysql> SELECT *
    -> FROM emp
    -> WHERE sal = ANY(
    -> SELECT MIN(sal)
    -> FROM emp
    -> WHERE job='manager'
    -> GROUP BY deptno
    -> );
+-------+-------+---------+------+---------------------+---------+------+--------+
| empno | ename | job     | mgr  | hiredate            | sal     | comm | deptno |
+-------+-------+---------+------+---------------------+---------+------+--------+
|  7566 | JONES | MANAGER | 7839 | 1981-04-02 00:00:00 | 2975.00 | NULL |     20 |
|  7698 | BLAKE | MANAGER | 7839 | 1981-05-01 00:00:00 | 2850.00 | NULL |     30 |
|  7782 | CLARK | MANAGER | 7839 | 1981-06-09 00:00:00 | 2450.00 | NULL |     10 |
+-------+-------+---------+------+---------------------+---------+------+--------+
3 rows in set (0.00 sec)
```
#### 查询出每个部门大于经理的工资
```
mysql> SELECT *
    -> FROM emp
    -> WHERE sal > ANY(
    -> SELECT MIN(sal)
    -> FROM emp
    -> WHERE job='manager'
    -> GROUP BY deptno
    -> );
+-------+-------+-----------+------+---------------------+---------+------+--------+
| empno | ename | job       | mgr  | hiredate            | sal     | comm | deptno |
+-------+-------+-----------+------+---------------------+---------+------+--------+
|  7566 | JONES | MANAGER   | 7839 | 1981-04-02 00:00:00 | 2975.00 | NULL |     20 |
|  7698 | BLAKE | MANAGER   | 7839 | 1981-05-01 00:00:00 | 2850.00 | NULL |     30 |
|  7788 | SCOTT | ANALYST   | 7566 | 1982-12-09 00:00:00 | 3000.00 | NULL |     20 |
|  7839 | KING  | PRESIDENT | NULL | 1981-11-17 00:00:00 | 5000.00 | NULL |     10 |
|  7902 | FORD  | ANALYST   | 7566 | 1981-12-03 00:00:00 | 3000.00 | NULL |     20 |
+-------+-------+-----------+------+---------------------+---------+------+--------+
5 rows in set (0.00 sec)
```
#### 查询出每个部门小于经理的工资
```
mysql> SELECT *
    -> FROM emp
    -> WHERE sal < ANY(
    -> SELECT MIN(sal)
    -> FROM emp
    -> WHERE job='manager'
    -> GROUP BY deptno
    -> );
+-------+--------+----------+------+---------------------+---------+---------+--------+
| empno | ename  | job      | mgr  | hiredate            | sal     | comm    | deptno |
+-------+--------+----------+------+---------------------+---------+---------+--------+
|  7369 | SMITH  | CLERK    | 7902 | 1980-12-17 00:00:00 |  800.00 |    NULL |     20 |
|  7499 | ALLEN  | SALESMAN | 7698 | 1981-02-20 00:00:00 | 1600.00 |  300.00 |     30 |
|  7521 | WARD   | SALESMAN | 7698 | 1981-02-22 00:00:00 | 1250.00 |  500.00 |     30 |
|  7654 | MARTIN | SALESMAN | 7698 | 1981-09-28 00:00:00 | 1250.00 | 1400.00 |     30 |
|  7698 | BLAKE  | MANAGER  | 7839 | 1981-05-01 00:00:00 | 2850.00 |    NULL |     30 |
|  7782 | CLARK  | MANAGER  | 7839 | 1981-06-09 00:00:00 | 2450.00 |    NULL |     10 |
|  7844 | TURNER | SALESMAN | 7698 | 1981-09-08 00:00:00 | 1500.00 |    0.00 |     30 |
|  7876 | ADAMS  | CLERK    | 7788 | 1983-01-12 00:00:00 | 1100.00 |    NULL |     20 |
|  7900 | JAMES  | CLERK    | 7698 | 1981-12-03 00:00:00 |  950.00 |    NULL |     30 |
|  7934 | MILLER | CLERK    | 7782 | 1982-01-23 00:00:00 | 1300.00 |    NULL |     10 |
+-------+--------+----------+------+---------------------+---------+---------+--------+
10 rows in set (0.00 sec)
```

### ALL操作符有以下三种用法：
<>ALL：等价于NOT IN（但是=ALL并不等价于IN）
>ALL：比子查询中最大的值还要大（还包含了>=ALL）
<ALL：比子查询中最小的值还要小（还包含了<=ALL）

#### 查询出每个部门不等于经理的工资
```
mysql> SELECT *
    -> FROM emp
    -> WHERE sal<>ALL(
    -> SELECT MIN(sal)
    -> FROM emp
    -> WHERE job='manager'
    -> GROUP BY deptno
    -> );
+-------+--------+-----------+------+---------------------+---------+---------+--------+
| empno | ename  | job       | mgr  | hiredate            | sal     | comm    | deptno |
+-------+--------+-----------+------+---------------------+---------+---------+--------+
|  7369 | SMITH  | CLERK     | 7902 | 1980-12-17 00:00:00 |  800.00 |    NULL |     20 |
|  7499 | ALLEN  | SALESMAN  | 7698 | 1981-02-20 00:00:00 | 1600.00 |  300.00 |     30 |
|  7521 | WARD   | SALESMAN  | 7698 | 1981-02-22 00:00:00 | 1250.00 |  500.00 |     30 |
|  7654 | MARTIN | SALESMAN  | 7698 | 1981-09-28 00:00:00 | 1250.00 | 1400.00 |     30 |
|  7788 | SCOTT  | ANALYST   | 7566 | 1982-12-09 00:00:00 | 3000.00 |    NULL |     20 |
|  7839 | KING   | PRESIDENT | NULL | 1981-11-17 00:00:00 | 5000.00 |    NULL |     10 |
|  7844 | TURNER | SALESMAN  | 7698 | 1981-09-08 00:00:00 | 1500.00 |    0.00 |     30 |
|  7876 | ADAMS  | CLERK     | 7788 | 1983-01-12 00:00:00 | 1100.00 |    NULL |     20 |
|  7900 | JAMES  | CLERK     | 7698 | 1981-12-03 00:00:00 |  950.00 |    NULL |     30 |
|  7902 | FORD   | ANALYST   | 7566 | 1981-12-03 00:00:00 | 3000.00 |    NULL |     20 |
|  7934 | MILLER | CLERK     | 7782 | 1982-01-23 00:00:00 | 1300.00 |    NULL |     10 |
+-------+--------+-----------+------+---------------------+---------+---------+--------+
11 rows in set (0.00 sec)
```

#### 查询出每个部门大于经理的工资
```
mysql> SELECT *
    -> FROM emp
    -> WHERE sal>ALL(
    -> SELECT MIN(sal)
    -> FROM emp
    -> WHERE job='manager'
    -> GROUP BY deptno
    -> );
+-------+-------+-----------+------+---------------------+---------+------+--------+
| empno | ename | job       | mgr  | hiredate            | sal     | comm | deptno |
+-------+-------+-----------+------+---------------------+---------+------+--------+
|  7788 | SCOTT | ANALYST   | 7566 | 1982-12-09 00:00:00 | 3000.00 | NULL |     20 |
|  7839 | KING  | PRESIDENT | NULL | 1981-11-17 00:00:00 | 5000.00 | NULL |     10 |
|  7902 | FORD  | ANALYST   | 7566 | 1981-12-03 00:00:00 | 3000.00 | NULL |     20 |
+-------+-------+-----------+------+---------------------+---------+------+--------+
3 rows in set (0.00 sec)
```

#### 查询出每个部门小于经理的工资
```
mysql> SELECT *
    -> FROM emp
    -> WHERE sal<ALL(
    -> SELECT MIN(sal)
    -> FROM emp
    -> WHERE job='manager'
    -> GROUP BY deptno
    -> );
+-------+--------+----------+------+---------------------+---------+---------+--------+
| empno | ename  | job      | mgr  | hiredate            | sal     | comm    | deptno |
+-------+--------+----------+------+---------------------+---------+---------+--------+
|  7369 | SMITH  | CLERK    | 7902 | 1980-12-17 00:00:00 |  800.00 |    NULL |     20 |
|  7499 | ALLEN  | SALESMAN | 7698 | 1981-02-20 00:00:00 | 1600.00 |  300.00 |     30 |
|  7521 | WARD   | SALESMAN | 7698 | 1981-02-22 00:00:00 | 1250.00 |  500.00 |     30 |
|  7654 | MARTIN | SALESMAN | 7698 | 1981-09-28 00:00:00 | 1250.00 | 1400.00 |     30 |
|  7844 | TURNER | SALESMAN | 7698 | 1981-09-08 00:00:00 | 1500.00 |    0.00 |     30 |
|  7876 | ADAMS  | CLERK    | 7788 | 1983-01-12 00:00:00 | 1100.00 |    NULL |     20 |
|  7900 | JAMES  | CLERK    | 7698 | 1981-12-03 00:00:00 |  950.00 |    NULL |     30 |
|  7934 | MILLER | CLERK    | 7782 | 1982-01-23 00:00:00 | 1300.00 |    NULL |     10 |
+-------+--------+----------+------+---------------------+---------+---------+--------+
8 rows in set (0.00 sec)
```

### 空数据判断
在SQL之中提供了一个exists结构用于判断子查询是否有数据返回。如果子查询中有数据返回，则exists结构返回true，反之返回false。

#### 验证exists结构
```
--验证exists结构
SELECT * FROM emp
    WHERE EXISTS(   --返回空值，没有内容输出
      SELECT * FROM emp WHERE empno=9999); --没有这个编号的员工
mysql> select *
    -> from emp
    -> where exists(
    -> select * from emp where empno=9999);
Empty set (0.00 sec)

```
### 有数据返回
```
SELECT * FROM emp
 WHERE EXISTS(SELECT * FROM emp);--有内容将返回数据
```
```
mysql> select * from emp
    -> where exists(
    -> select * from emp);
+-------+--------+-----------+------+---------------------+---------+---------+--------+
| empno | ename  | job       | mgr  | hiredate            | sal     | comm    | deptno |
+-------+--------+-----------+------+---------------------+---------+---------+--------+
|  7369 | SMITH  | CLERK     | 7902 | 1980-12-17 00:00:00 |  800.00 |    NULL |     20 |
|  7499 | ALLEN  | SALESMAN  | 7698 | 1981-02-20 00:00:00 | 1600.00 |  300.00 |     30 |
|  7521 | WARD   | SALESMAN  | 7698 | 1981-02-22 00:00:00 | 1250.00 |  500.00 |     30 |
|  7566 | JONES  | MANAGER   | 7839 | 1981-04-02 00:00:00 | 2975.00 |    NULL |     20 |
|  7654 | MARTIN | SALESMAN  | 7698 | 1981-09-28 00:00:00 | 1250.00 | 1400.00 |     30 |
|  7698 | BLAKE  | MANAGER   | 7839 | 1981-05-01 00:00:00 | 2850.00 |    NULL |     30 |
|  7782 | CLARK  | MANAGER   | 7839 | 1981-06-09 00:00:00 | 2450.00 |    NULL |     10 |
|  7788 | SCOTT  | ANALYST   | 7566 | 1982-12-09 00:00:00 | 3000.00 |    NULL |     20 |
|  7839 | KING   | PRESIDENT | NULL | 1981-11-17 00:00:00 | 5000.00 |    NULL |     10 |
|  7844 | TURNER | SALESMAN  | 7698 | 1981-09-08 00:00:00 | 1500.00 |    0.00 |     30 |
|  7876 | ADAMS  | CLERK     | 7788 | 1983-01-12 00:00:00 | 1100.00 |    NULL |     20 |
|  7900 | JAMES  | CLERK     | 7698 | 1981-12-03 00:00:00 |  950.00 |    NULL |     30 |
|  7902 | FORD   | ANALYST   | 7566 | 1981-12-03 00:00:00 | 3000.00 |    NULL |     20 |
|  7934 | MILLER | CLERK     | 7782 | 1982-01-23 00:00:00 | 1300.00 |    NULL |     10 |
+-------+--------+-----------+------+---------------------+---------+---------+--------+
14 rows in set (0.00 sec)
```
#### 测试取反
```
mysql>  SELECT * FROM emp
    ->  WHERE NOT EXISTS(SELECT * FROM emp);--有数据，但取返，没有内容输出
Empty set (0.00 sec)
```